<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>40-Day Habit Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-30px,0); }
            70% { transform: translate3d(0,-15px,0); }
            90% { transform: translate3d(0,-4px,0); }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .blur-interaction {
            position: relative;
        }
        .blur-interaction::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(2px);
            z-index: 10;
        }
    </style>
</head>
<body>
    <div id="loading" style="display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 24px;">
        Loading your habit tracker... ‚è≥
    </div>
    <div id="root"></div>

    <script>
        function initializeApp() {
            if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                setTimeout(initializeApp, 100);
                return;
            }

            document.getElementById('loading').style.display = 'none';
            document.getElementById('root').style.display = 'block';

            const { useState, useEffect } = React;
            const { createElement: h } = React;

            function HabitTracker() {
                // Authentication state
                const [isAuthenticated, setIsAuthenticated] = useState(false);
                const [currentUser, setCurrentUser] = useState(null);
                const [showAuthModal, setShowAuthModal] = useState(false);
                const [authMode, setAuthMode] = useState('login'); // 'login' or 'register'
                const [authForm, setAuthForm] = useState({ email: '', password: '', confirmPassword: '' });

                // App state (only active when authenticated)
                const [currentDay, setCurrentDay] = useState(1);
                const [activities, setActivities] = useState([
                    { id: 1, name: 'Morning Exercise', color: 'from-blue-400 to-blue-600', icon: 'üèÉ‚Äç‚ôÇÔ∏è' },
                    { id: 2, name: 'Read 30 Minutes', color: 'from-green-400 to-green-600', icon: 'üìö' },
                    { id: 3, name: 'Meditate', color: 'from-purple-400 to-purple-600', icon: 'üßò‚Äç‚ôÄÔ∏è' },
                    { id: 4, name: 'Drink 8 Glasses Water', color: 'from-cyan-400 to-cyan-600', icon: 'üíß' },
                    { id: 5, name: 'Journal', color: 'from-orange-400 to-orange-600', icon: '‚úçÔ∏è' }
                ]);
                
                const [completedActivities, setCompletedActivities] = useState({});
                const [showCelebration, setShowCelebration] = useState(false);
                const [isEditingActivities, setIsEditingActivities] = useState(false);
                const [newActivity, setNewActivity] = useState({ name: '', icon: '‚ú®' });
                const [editingActivity, setEditingActivity] = useState(null);
                
                // Supabase state
                const [supabaseUrl, setSupabaseUrl] = useState('');
                const [supabaseKey, setSupabaseKey] = useState('');
                const [userId, setUserId] = useState('');
                const [isConnected, setIsConnected] = useState(false);
                const [showSupabaseSetup, setShowSupabaseSetup] = useState(false);

                // Check for saved authentication on load
                useEffect(() => {
                    const savedAuth = localStorage.getItem('habitTrackerAuth');
                    if (savedAuth) {
                        const authData = JSON.parse(savedAuth);
                        setIsAuthenticated(true);
                        setCurrentUser(authData.user);
                        // Load user's data if available
                        const savedData = localStorage.getItem(`habitTrackerData_${authData.user.email}`);
                        if (savedData) {
                            const userData = JSON.parse(savedData);
                            setActivities(userData.activities || activities);
                            setCompletedActivities(userData.completedActivities || {});
                            setCurrentDay(userData.currentDay || 1);
                        }
                    }
                }, []);

                // Initialize completed activities structure
                useEffect(() => {
                    if (isAuthenticated) {
                        const initialState = {};
                        for (let day = 1; day <= 40; day++) {
                            initialState[day] = {};
                            activities.forEach(activity => {
                                initialState[day][activity.id] = false;
                            });
                        }
                        if (Object.keys(completedActivities).length === 0) {
                            setCompletedActivities(initialState);
                        }
                    }
                }, [isAuthenticated, activities]);

                // Save data when authenticated and data changes
                useEffect(() => {
                    if (isAuthenticated && currentUser) {
                        const userData = {
                            activities,
                            completedActivities,
                            currentDay,
                            lastUpdated: new Date().toISOString()
                        };
                        localStorage.setItem(`habitTrackerData_${currentUser.email}`, JSON.stringify(userData));
                    }
                }, [activities, completedActivities, currentDay, isAuthenticated, currentUser]);

                const handleAuth = () => {
                    if (authMode === 'login') {
                        // Simple login (in real app, this would validate against a backend)
                        if (authForm.email && authForm.password) {
                            const user = { email: authForm.email, name: authForm.email.split('@')[0] };
                            setCurrentUser(user);
                            setIsAuthenticated(true);
                            setShowAuthModal(false);
                            setAuthForm({ email: '', password: '', confirmPassword: '' });
                            
                            // Save auth state
                            localStorage.setItem('habitTrackerAuth', JSON.stringify({ user }));
                        } else {
                            alert('Please enter both email and password');
                        }
                    } else {
                        // Simple registration
                        if (authForm.email && authForm.password && authForm.password === authForm.confirmPassword) {
                            const user = { email: authForm.email, name: authForm.email.split('@')[0] };
                            setCurrentUser(user);
                            setIsAuthenticated(true);
                            setShowAuthModal(false);
                            setAuthForm({ email: '', password: '', confirmPassword: '' });
                            
                            // Save auth state
                            localStorage.setItem('habitTrackerAuth', JSON.stringify({ user }));
                        } else if (authForm.password !== authForm.confirmPassword) {
                            alert('Passwords do not match');
                        } else {
                            alert('Please fill in all fields');
                        }
                    }
                };

                const handleLogout = () => {
                    setIsAuthenticated(false);
                    setCurrentUser(null);
                    setActivities([
                        { id: 1, name: 'Morning Exercise', color: 'from-blue-400 to-blue-600', icon: 'üèÉ‚Äç‚ôÇÔ∏è' },
                        { id: 2, name: 'Read 30 Minutes', color: 'from-green-400 to-green-600', icon: 'üìö' },
                        { id: 3, name: 'Meditate', color: 'from-purple-400 to-purple-600', icon: 'üßò‚Äç‚ôÄÔ∏è' },
                        { id: 4, name: 'Drink 8 Glasses Water', color: 'from-cyan-400 to-cyan-600', icon: 'üíß' },
                        { id: 5, name: 'Journal', color: 'from-orange-400 to-orange-600', icon: '‚úçÔ∏è' }
                    ]);
                    setCompletedActivities({});
                    setCurrentDay(1);
                    localStorage.removeItem('habitTrackerAuth');
                };

                const showAuthPrompt = (mode) => {
                    setAuthMode(mode);
                    setShowAuthModal(true);
                };

                const toggleActivity = (dayNum, activityId) => {
                    if (!isAuthenticated) {
                        showAuthPrompt('login');
                        return;
                    }

                    setCompletedActivities(prev => ({
                        ...prev,
                        [dayNum]: {
                            ...prev[dayNum],
                            [activityId]: !prev[dayNum]?.[activityId]
                        }
                    }));

                    const dayActivities = { ...completedActivities[dayNum] };
                    dayActivities[activityId] = !dayActivities[activityId];
                    const allCompleted = activities.every(activity => dayActivities[activity.id]);
                    
                    if (allCompleted && !completedActivities[dayNum]?.[activityId]) {
                        setShowCelebration(true);
                        setTimeout(() => setShowCelebration(false), 2000);
                    }
                };

                const getActivityStreak = (activityId) => {
                    let streak = 0;
                    for (let day = currentDay; day >= 1; day--) {
                        if (completedActivities[day]?.[activityId]) {
                            streak++;
                        } else {
                            break;
                        }
                    }
                    return streak;
                };

                const getTotalProgress = () => {
                    let completed = 0;
                    let total = 0;
                    for (let day = 1; day <= 40; day++) {
                        activities.forEach(activity => {
                            total++;
                            if (completedActivities[day]?.[activity.id]) {
                                completed++;
                            }
                        });
                    }
                    return Math.round((completed / total) * 100);
                };

                const getDayProgress = (dayNum) => {
                    if (!completedActivities[dayNum]) return 0;
                    const completed = activities.filter(activity => completedActivities[dayNum][activity.id]).length;
                    return Math.round((completed / activities.length) * 100);
                };

                const getCompletedDays = () => {
                    let completedDays = 0;
                    for (let day = 1; day <= 40; day++) {
                        if (getDayProgress(day) === 100) {
                            completedDays++;
                        }
                    }
                    return completedDays;
                };

                const availableColors = [
                    'from-blue-400 to-blue-600', 'from-green-400 to-green-600', 'from-purple-400 to-purple-600',
                    'from-cyan-400 to-cyan-600', 'from-orange-400 to-orange-600', 'from-pink-400 to-pink-600',
                    'from-red-400 to-red-600', 'from-indigo-400 to-indigo-600', 'from-yellow-400 to-yellow-600',
                    'from-teal-400 to-teal-600'
                ];

                const availableIcons = ['‚ú®', 'üèÉ‚Äç‚ôÇÔ∏è', 'üìö', 'üßò‚Äç‚ôÄÔ∏è', 'üíß', '‚úçÔ∏è', 'üçé', 'üí™', 'üéØ', 'üå±', 'üéµ', 'üî•', '‚≠ê', 'üöÄ', 'üíù'];

                const addActivity = () => {
                    if (!isAuthenticated) {
                        showAuthPrompt('login');
                        return;
                    }
                    if (!newActivity.name.trim()) return;
                    
                    const maxId = Math.max(...activities.map(a => a.id), 0);
                    const newId = maxId + 1;
                    const randomColor = availableColors[Math.floor(Math.random() * availableColors.length)];
                    
                    const activity = {
                        id: newId,
                        name: newActivity.name,
                        color: randomColor,
                        icon: newActivity.icon
                    };

                    setActivities([...activities, activity]);
                    setNewActivity({ name: '', icon: '‚ú®' });

                    setCompletedActivities(prev => {
                        const updated = { ...prev };
                        for (let day = 1; day <= 40; day++) {
                            if (!updated[day]) updated[day] = {};
                            updated[day][newId] = false;
                        }
                        return updated;
                    });
                };

                const deleteActivity = (activityId) => {
                    if (!isAuthenticated) {
                        showAuthPrompt('login');
                        return;
                    }
                    setActivities(activities.filter(a => a.id !== activityId));
                    
                    setCompletedActivities(prev => {
                        const updated = { ...prev };
                        for (let day = 1; day <= 40; day++) {
                            if (updated[day]) {
                                delete updated[day][activityId];
                            }
                        }
                        return updated;
                    });
                };

                const updateActivity = (activityId, updates) => {
                    if (!isAuthenticated) {
                        showAuthPrompt('login');
                        return;
                    }
                    setActivities(activities.map(a => 
                        a.id === activityId ? { ...a, ...updates } : a
                    ));
                    setEditingActivity(null);
                };

                const moveActivity = (activityId, direction) => {
                    if (!isAuthenticated) {
                        showAuthPrompt('login');
                        return;
                    }
                    const currentIndex = activities.findIndex(a => a.id === activityId);
                    const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;
                    
                    if (newIndex < 0 || newIndex >= activities.length) return;
                    
                    const newActivities = [...activities];
                    [newActivities[currentIndex], newActivities[newIndex]] = [newActivities[newIndex], newActivities[currentIndex]];
                    setActivities(newActivities);
                };

                const exportData = () => {
                    if (!isAuthenticated) {
                        showAuthPrompt('login');
                        return;
                    }
                    const exportObject = {
                        version: '1.0',
                        exportDate: new Date().toISOString(),
                        currentDay,
                        activities,
                        completedActivities,
                        user: currentUser.email
                    };
                    
                    const dataStr = JSON.stringify(exportObject, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `40-day-tracker-${currentUser.name}-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                };

                const importData = (event) => {
                    if (!isAuthenticated) {
                        showAuthPrompt('login');
                        return;
                    }
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            if (importedData.activities && importedData.completedActivities) {
                                setActivities(importedData.activities);
                                setCompletedActivities(importedData.completedActivities);
                                if (importedData.currentDay) {
                                    setCurrentDay(importedData.currentDay);
                                }
                                alert('Data imported successfully!');
                            } else {
                                alert('Invalid file format. Please select a valid tracker export file.');
                            }
                        } catch (error) {
                            alert('Error reading file. Please make sure it\'s a valid JSON export file.');
                        }
                    };
                    reader.readAsText(file);
                    event.target.value = '';
                };

                const connectToSupabase = () => {
                    if (!isAuthenticated) {
                        showAuthPrompt('login');
                        return;
                    }
                    if (supabaseUrl && supabaseKey && userId) {
                        setIsConnected(true);
                        setShowSupabaseSetup(false);
                        alert('Successfully connected to Supabase! Your data will now sync to the cloud.');
                    }
                };

                return h('div', { className: 'min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50' }, [
                    // Celebration Animation
                    showCelebration && h('div', { 
                        key: 'celebration',
                        className: 'fixed inset-0 flex items-center justify-center z-50 pointer-events-none' 
                    }, 
                        h('div', { className: 'animate-bounce text-6xl' }, 'üéâ')
                    ),

                    // Auth Modal
                    showAuthModal && h('div', {
                        key: 'auth-modal',
                        className: 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4'
                    },
                        h('div', { className: 'bg-white rounded-2xl shadow-2xl max-w-md w-full p-6' }, [
                            h('div', { key: 'header', className: 'flex items-center justify-between mb-4' }, [
                                h('h3', { className: 'text-xl font-bold text-gray-800' }, 
                                    authMode === 'login' ? 'Sign In' : 'Create Account'
                                ),
                                h('button', {
                                    onClick: () => setShowAuthModal(false),
                                    className: 'p-2 hover:bg-gray-100 rounded-lg'
                                }, '‚úï')
                            ]),
                            h('div', { key: 'content', className: 'space-y-4' }, [
                                h('div', {}, [
                                    h('p', { className: 'text-gray-600 mb-4' }, 
                                        authMode === 'login' 
                                            ? 'Sign in to access your personalized habit tracker with custom activities, progress tracking, and data sync.'
                                            : 'Create your account to start your personalized 40-day habit transformation journey!'
                                    )
                                ]),
                                h('div', {}, [
                                    h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Email'),
                                    h('input', {
                                        type: 'email',
                                        value: authForm.email,
                                        onChange: (e) => setAuthForm({ ...authForm, email: e.target.value }),
                                        placeholder: 'your@email.com',
                                        className: 'w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none'
                                    })
                                ]),
                                h('div', {}, [
                                    h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Password'),
                                    h('input', {
                                        type: 'password',
                                        value: authForm.password,
                                        onChange: (e) => setAuthForm({ ...authForm, password: e.target.value }),
                                        placeholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢',
                                        className: 'w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none'
                                    })
                                ]),
                                authMode === 'register' && h('div', {}, [
                                    h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Confirm Password'),
                                    h('input', {
                                        type: 'password',
                                        value: authForm.confirmPassword,
                                        onChange: (e) => setAuthForm({ ...authForm, confirmPassword: e.target.value }),
                                        placeholder: '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢',
                                        className: 'w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none'
                                    })
                                ]),
                                h('button', {
                                    onClick: handleAuth,
                                    className: 'w-full px-4 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:opacity-90 transition-all duration-200'
                                }, authMode === 'login' ? 'Sign In' : 'Create Account'),
                                h('div', { className: 'text-center' }, [
                                    h('p', { className: 'text-sm text-gray-600' },
                                        authMode === 'login' 
                                            ? "Don't have an account? "
                                            : "Already have an account? "
                                    ),
                                    h('button', {
                                        onClick: () => setAuthMode(authMode === 'login' ? 'register' : 'login'),
                                        className: 'text-indigo-600 hover:text-indigo-800 font-medium'
                                    }, authMode === 'login' ? 'Sign up' : 'Sign in')
                                ])
                            ])
                        ])
                    ),

                    // Header
                    h('div', { 
                        key: 'header',
                        className: 'bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-40' 
                    },
                        h('div', { className: 'max-w-6xl mx-auto px-6 py-6' },
                            h('div', { className: 'flex items-center justify-between flex-wrap gap-4' }, [
                                h('div', { key: 'title', className: 'flex items-center gap-3' }, [
                                    h('div', { 
                                        key: 'icon',
                                        className: 'p-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl text-white' 
                                    }, 'üéØ'),
                                    h('div', { key: 'text' }, [
                                        h('h1', { className: 'text-2xl font-bold text-gray-800' }, '40-Day Challenge'),
                                        h('p', { className: 'text-gray-600' }, isAuthenticated 
                                            ? `Welcome back, ${currentUser?.name}!`
                                            : 'Transform your habits, day by day'
                                        )
                                    ])
                                ]),
                                h('div', { key: 'controls', className: 'flex items-center gap-6' }, [
                                    !isAuthenticated ? h('div', { key: 'auth-buttons', className: 'flex items-center gap-2' }, [
                                        h('button', {
                                            onClick: () => showAuthPrompt('login'),
                                            className: 'px-4 py-2 text-indigo-600 border border-indigo-600 rounded-lg hover:bg-indigo-50 transition-all duration-200'
                                        }, 'Sign In'),
                                        h('button', {
                                            onClick: () => showAuthPrompt('register'),
                                            className: 'px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:opacity-90 transition-all duration-200'
                                        }, 'Sign Up')
                                    ]) : [
                                        h('div', { key: 'app-buttons', className: 'flex items-center gap-2' }, [
                                            h('button', {
                                                key: 'setup',
                                                onClick: () => setShowSupabaseSetup(true),
                                                className: `flex items-center gap-2 px-3 py-2 rounded-xl transition-all duration-200 ${
                                                    isConnected 
                                                        ? 'bg-green-100 text-green-700' 
                                                        : 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200'
                                                }`,
                                                title: isConnected ? 'Connected to cloud' : 'Setup cloud sync'
                                            }, [
                                                h('span', { key: 'icon' }, isConnected ? '‚òÅÔ∏è' : 'üîí'),
                                                h('span', { key: 'text', className: 'hidden sm:inline' }, isConnected ? 'Cloud' : 'Setup')
                                            ]),
                                            h('button', {
                                                key: 'export',
                                                onClick: exportData,
                                                className: 'flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-xl transition-all duration-200',
                                                title: 'Export backup file'
                                            }, [
                                                h('span', { key: 'icon' }, '‚¨áÔ∏è'),
                                                h('span', { key: 'text', className: 'hidden sm:inline' }, 'Export')
                                            ]),
                                            h('label', {
                                                key: 'import',
                                                className: 'flex items-center gap-2 px-3 py-2 bg-purple-100 text-purple-700 hover:bg-purple-200 rounded-xl transition-all duration-200 cursor-pointer'
                                            }, [
                                                h('span', { key: 'icon' }, '‚¨ÜÔ∏è'),
                                                h('span', { key: 'text', className: 'hidden sm:inline' }, 'Import'),
                                                h('input', {
                                                    key: 'input',
                                                    type: 'file',
                                                    accept: '.json',
                                                    onChange: importData,
                                                    className: 'hidden'
                                                })
                                            ])
                                        ]),
                                        h('button', {
                                            key: 'edit',
                                            onClick: () => {
                                                if (!isAuthenticated) {
                                                    showAuthPrompt('login');
                                                    return;
                                                }
                                                setIsEditingActivities(!isEditingActivities);
                                            },
                                            className: `flex items-center gap-2 px-4 py-2 rounded-xl transition-all duration-200 ${
                                                isEditingActivities 
                                                    ? 'bg-indigo-100 text-indigo-700' 
                                                    : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                            }`
                                        }, [
                                            h('span', { key: 'icon' }, '‚öôÔ∏è'),
                                            h('span', { key: 'text', className: 'hidden sm:inline' }, 'Edit Activities')
                                        ]),
                                        h('div', { key: 'stats1', className: 'text-center' }, [
                                            h('div', { className: 'text-2xl font-bold text-indigo-600' }, `${getCompletedDays()}/40`),
                                            h('div', { className: 'text-sm text-gray-600' }, 'Perfect Days')
                                        ]),
                                        h('div', { key: 'stats2', className: 'text-center' }, [
                                            h('div', { className: 'text-2xl font-bold text-purple-600' }, `${getTotalProgress()}%`),
                                            h('div', { className: 'text-sm text-gray-600' }, 'Overall Progress')
                                        ]),
                                        h('button', {
                                            key: 'logout',
                                            onClick: handleLogout,
                                            className: 'px-3 py-2 text-gray-600 hover:text-gray-800 transition-all duration-200',
                                            title: 'Sign out'
                                        }, 'üö™')
                                    ]
                                ])
                            ])
                        )
                    ),

                    // Main Content Container
                    h('div', { key: 'main', className: 'max-w-6xl mx-auto px-6 py-8' }, [
                        // Demo banner for non-authenticated users
                        !isAuthenticated && h('div', {
                            key: 'demo-banner',
                            className: 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-2xl p-6 mb-8 text-center'
                        }, [
                            h('h2', { className: 'text-2xl font-bold mb-2' }, '‚ú® Preview Mode'),
                            h('p', { className: 'mb-4' }, 'You\'re viewing a demo of the 40-Day Habit Tracker. Sign up for a personalized experience with custom activities, progress tracking, and data sync!'),
                            h('div', { className: 'flex justify-center gap-4' }, [
                                h('button', {
                                    onClick: () => showAuthPrompt('register'),
                                    className: 'px-6 py-3 bg-white text-indigo-600 rounded-lg font-semibold hover:bg-gray-100 transition-all duration-200'
                                }, 'Create Free Account'),
                                h('button', {
                                    onClick: () => showAuthPrompt('login'),
                                    className: 'px-6 py-3 border-2 border-white text-white rounded-lg font-semibold hover:bg-white hover:text-indigo-600 transition-all duration-200'
                                }, 'Sign In')
                            ])
                        ]),

                        // Supabase Setup Modal (only for authenticated users)
                        isAuthenticated && showSupabaseSetup && h('div', {
                            key: 'supabase-modal',
                            className: 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4'
                        },
                            h('div', { className: 'bg-white rounded-2xl shadow-2xl max-w-md w-full p-6' }, [
                                h('div', { key: 'header', className: 'flex items-center justify-between mb-4' }, [
                                    h('h3', { className: 'text-xl font-bold text-gray-800' }, 'Cloud Sync Setup'),
                                    h('button', {
                                        onClick: () => setShowSupabaseSetup(false),
                                        className: 'p-2 hover:bg-gray-100 rounded-lg'
                                    }, '‚úï')
                                ]),
                                !isConnected ? h('div', { key: 'form', className: 'space-y-4' }, [
                                    h('div', { key: 'url' }, [
                                        h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Supabase Project URL'),
                                        h('input', {
                                            type: 'text',
                                            value: supabaseUrl,
                                            onChange: (e) => setSupabaseUrl(e.target.value),
                                            placeholder: 'https://your-project.supabase.co',
                                            className: 'w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none'
                                        })
                                    ]),
                                    h('div', { key: 'key' }, [
                                        h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Supabase API Key'),
                                        h('input', {
                                            type: 'password',
                                            value: supabaseKey,
                                            onChange: (e) => setSupabaseKey(e.target.value),
                                            placeholder: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...',
                                            className: 'w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none'
                                        })
                                    ]),
                                    h('div', { key: 'user' }, [
                                        h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Your User ID'),
                                        h('input', {
                                            type: 'text',
                                            value: userId,
                                            onChange: (e) => setUserId(e.target.value),
                                            placeholder: 'your-name-or-email',
                                            className: 'w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none'
                                        })
                                    ]),
                                    h('button', {
                                        key: 'connect',
                                        onClick: connectToSupabase,
                                        disabled: !supabaseUrl || !supabaseKey || !userId,
                                        className: 'w-full px-4 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200'
                                    }, 'Connect to Cloud')
                                ]) : h('div', { key: 'connected', className: 'text-center space-y-4' }, [
                                    h('div', { className: 'text-green-600' }, [
                                        h('div', { className: 'text-4xl mb-2' }, '‚òÅÔ∏è'),
                                        h('p', { className: 'font-semibold' }, 'Connected to Cloud!'),
                                        h('p', { className: 'text-sm text-gray-600' }, 'Your progress syncs to Supabase')
                                    ]),
                                    h('button', {
                                        onClick: () => {
                                            setIsConnected(false);
                                            setShowSupabaseSetup(false);
                                        },
                                        className: 'w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200'
                                    }, 'Disconnect')
                                ])
                            ])
                        ),

                        // Activity Editor (with auth protection)
                        isEditingActivities && h('div', { 
                            key: 'edit-activities', 
                            className: isAuthenticated ? 'bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden mb-8' : 'bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden mb-8 blur-interaction'
                        }, [
                            !isAuthenticated && h('div', {
                                key: 'auth-overlay',
                                className: 'absolute inset-0 flex items-center justify-center z-20 bg-white/90'
                            }, 
                                h('div', { className: 'text-center p-6' }, [
                                    h('h3', { className: 'text-xl font-bold text-gray-800 mb-2' }, 'üîí Account Required'),
                                    h('p', { className: 'text-gray-600 mb-4' }, 'Having an account will provide a much more customized experience!'),
                                    h('div', { className: 'flex gap-3 justify-center' }, [
                                        h('button', {
                                            onClick: () => showAuthPrompt('register'),
                                            className: 'px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:opacity-90'
                                        }, 'Register'),
                                        h('button', {
                                            onClick: () => showAuthPrompt('login'),
                                            className: 'px-4 py-2 border border-indigo-500 text-indigo-500 rounded-lg hover:bg-indigo-50'
                                        }, 'Login')
                                    ])
                                ])
                            ),
                            h('div', { key: 'header', className: 'bg-gradient-to-r from-gray-700 to-gray-900 px-6 py-4' },
                                h('h2', { className: 'text-xl font-bold text-white' }, 'Customize Your Activities')
                            ),
                            h('div', { key: 'content', className: 'p-6 space-y-6' }, [
                                h('div', { key: 'add-activity', className: 'bg-gray-50 rounded-xl p-4' }, [
                                    h('h3', { className: 'font-semibold text-gray-800 mb-4' }, 'Add New Activity'),
                                    h('div', { className: 'flex gap-3' }, [
                                        h('select', {
                                            value: newActivity.icon,
                                            onChange: (e) => setNewActivity({ ...newActivity, icon: e.target.value }),
                                            className: 'p-2 rounded-lg border border-gray-300 bg-white text-xl'
                                        }, availableIcons.map(icon =>
                                            h('option', { key: icon, value: icon }, icon)
                                        )),
                                        h('input', {
                                            type: 'text',
                                            value: newActivity.name,
                                            onChange: (e) => setNewActivity({ ...newActivity, name: e.target.value }),
                                            placeholder: 'Activity name (e.g., Walk 10,000 steps)',
                                            className: 'flex-1 p-3 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none',
                                            onKeyPress: (e) => e.key === 'Enter' && addActivity()
                                        }),
                                        h('button', {
                                            onClick: addActivity,
                                            disabled: !newActivity.name.trim(),
                                            className: 'px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200'
                                        }, '‚ûï')
                                    ])
                                ]),
                                h('div', { key: 'activities-list' }, [
                                    h('h3', { className: 'font-semibold text-gray-800 mb-4' }, 'Your Activities'),
                                    h('div', { className: 'space-y-3' },
                                        activities.map((activity, index) =>
                                            h('div', { key: activity.id, className: 'flex items-center gap-4 p-4 bg-gray-50 rounded-xl' }, [
                                                editingActivity === activity.id ? [
                                                    h('select', {
                                                        key: 'icon-edit',
                                                        value: activity.icon,
                                                        onChange: (e) => updateActivity(activity.id, { icon: e.target.value }),
                                                        className: 'p-2 rounded-lg border border-gray-300 bg-white text-xl'
                                                    }, availableIcons.map(icon =>
                                                        h('option', { key: icon, value: icon }, icon)
                                                    )),
                                                    h('input', {
                                                        key: 'name-edit',
                                                        type: 'text',
                                                        value: activity.name,
                                                        onChange: (e) => updateActivity(activity.id, { name: e.target.value }),
                                                        className: 'flex-1 p-2 rounded-lg border border-gray-300 focus:border-indigo-500 focus:outline-none',
                                                        onKeyPress: (e) => e.key === 'Enter' && setEditingActivity(null),
                                                        onBlur: () => setEditingActivity(null),
                                                        autoFocus: true
                                                    })
                                                ] : [
                                                    h('div', { key: 'icon', className: 'text-2xl' }, activity.icon),
                                                    h('div', { key: 'name', className: 'flex-1 font-medium text-gray-800' }, activity.name),
                                                    h('div', { key: 'controls', className: 'flex items-center gap-1' }, [
                                                        h('button', {
                                                            onClick: () => moveActivity(activity.id, 'up'),
                                                            disabled: index === 0,
                                                            className: 'p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-100 rounded-lg transition-all duration-200 disabled:opacity-30 disabled:cursor-not-allowed',
                                                            title: 'Move up'
                                                        }, '‚¨ÜÔ∏è'),
                                                        h('button', {
                                                            onClick: () => moveActivity(activity.id, 'down'),
                                                            disabled: index === activities.length - 1,
                                                            className: 'p-1.5 text-gray-500 hover:text-indigo-600 hover:bg-indigo-100 rounded-lg transition-all duration-200 disabled:opacity-30 disabled:cursor-not-allowed',
                                                            title: 'Move down'
                                                        }, '‚¨áÔ∏è'),
                                                        h('button', {
                                                            onClick: () => setEditingActivity(activity.id),
                                                            className: 'p-2 text-gray-500 hover:text-indigo-600 hover:bg-indigo-100 rounded-lg transition-all duration-200',
                                                            title: 'Edit activity'
                                                        }, '‚úèÔ∏è'),
                                                        h('button', {
                                                            onClick: () => deleteActivity(activity.id),
                                                            className: 'p-2 text-gray-500 hover:text-red-600 hover:bg-red-100 rounded-lg transition-all duration-200',
                                                            title: 'Delete activity'
                                                        }, '‚ùå')
                                                    ])
                                                ]
                                            ])
                                        )
                                    )
                                ])
                            ])
                        ]),

                        // Day Selector
                        h('div', { key: 'days', className: 'mb-8' }, [
                            h('div', { key: 'header', className: 'flex items-center gap-4 mb-4' }, [
                                h('span', { className: 'text-indigo-600 text-xl' }, 'üìÖ'),
                                h('h2', { className: 'text-lg font-semibold text-gray-800' }, 'Select Day')
                            ]),
                            h('div', { key: 'buttons', className: 'flex flex-wrap gap-2' },
                                Array.from({ length: 40 }, (_, i) => i + 1).map(day =>
                                    h('button', {
                                        key: day,
                                        onClick: () => isAuthenticated ? setCurrentDay(day) : showAuthPrompt('login'),
                                        className: `w-12 h-12 rounded-lg font-semibold transition-all duration-200 ${
                                            currentDay === day
                                                ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg scale-110'
                                                : getDayProgress(day) === 100
                                                ? 'bg-gradient-to-r from-green-400 to-green-600 text-white'
                                                : getDayProgress(day) > 0
                                                ? 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white'
                                                : 'bg-white border-2 border-gray-200 text-gray-600 hover:border-indigo-300'
                                        }`
                                    }, day.toString())
                                )
                            )
                        ]),

                        // Current Day Activities
                        h('div', { 
                            key: 'activities', 
                            className: !isAuthenticated ? 'bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden mb-8 blur-interaction' : 'bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden mb-8'
                        }, [
                            !isAuthenticated && h('div', {
                                key: 'auth-overlay',
                                className: 'absolute inset-0 flex items-center justify-center z-20 bg-white/90'
                            }, 
                                h('div', { className: 'text-center p-6' }, [
                                    h('h3', { className: 'text-xl font-bold text-gray-800 mb-2' }, 'üîí Account Required'),
                                    h('p', { className: 'text-gray-600 mb-4' }, 'Having an account will provide a much more customized experience!'),
                                    h('div', { className: 'flex gap-3 justify-center' }, [
                                        h('button', {
                                            onClick: () => showAuthPrompt('register'),
                                            className: 'px-4 py-2 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:opacity-90'
                                        }, 'Register'),
                                        h('button', {
                                            onClick: () => showAuthPrompt('login'),
                                            className: 'px-4 py-2 border border-indigo-500 text-indigo-500 rounded-lg hover:bg-indigo-50'
                                        }, 'Login')
                                    ])
                                ])
                            ),
                            h('div', { key: 'header', className: 'bg-gradient-to-r from-indigo-500 to-purple-600 px-6 py-4' },
                                h('div', { className: 'flex items-center justify-between text-white' }, [
                                    h('h2', { className: 'text-xl font-bold' }, `Day ${currentDay} Activities`),
                                    h('div', { className: 'flex items-center gap-2' }, [
                                        h('div', { className: 'text-sm opacity-90' }, 'Progress:'),
                                        h('div', { className: 'text-lg font-bold' }, `${getDayProgress(currentDay)}%`)
                                    ])
                                ])
                            ),
                            h('div', { key: 'content', className: 'p-6 space-y-4' },
                                activities.map(activity => {
                                    const isCompleted = completedActivities[currentDay]?.[activity.id];
                                    const streak = getActivityStreak(activity.id);
                                    
                                    return h('div', {
                                        key: activity.id,
                                        className: `p-4 rounded-xl border-2 transition-all duration-300 cursor-pointer ${
                                            isCompleted
                                                ? 'border-green-300 bg-green-50'
                                                : 'border-gray-200 bg-gray-50 hover:border-indigo-300 hover:bg-indigo-50'
                                        }`,
                                        onClick: () => toggleActivity(currentDay, activity.id)
                                    },
                                        h('div', { className: 'flex items-center justify-between' }, [
                                            h('div', { key: 'info', className: 'flex items-center gap-4' }, [
                                                h('div', { className: 'text-2xl' }, activity.icon),
                                                h('div', { key: 'details' }, [
                                                    h('h3', { className: 'font-semibold text-gray-800' }, activity.name),
                                                    streak > 0 && h('div', { className: 'flex items-center gap-1 mt-1' }, [
                                                        h('span', { className: 'text-orange-500' }, 'üî•'),
                                                        h('span', { className: 'text-sm text-orange-600' }, `${streak} day streak`)
                                                    ])
                                                ])
                                            ]),
                                            h('div', {
                                                key: 'status',
                                                className: `p-2 rounded-full transition-all duration-200 ${
                                                    isCompleted ? 'bg-green-500' : 'bg-gray-300'
                                                }`
                                            }, 
                                                h('span', { 
                                                    className: 'text-white text-xl block w-6 h-6 flex items-center justify-center' 
                                                }, isCompleted ? '‚úì' : '‚óã')
                                            )
                                        ])
                                    );
                                })
                            )
                        ]),

                        // Statistics Cards
                        h('div', { key: 'stats', className: 'grid grid-cols-1 md:grid-cols-3 gap-6 mb-8' }, [
                            h('div', { key: 'streak', className: 'bg-white rounded-xl p-6 shadow-lg border border-gray-100' }, [
                                h('div', { className: 'flex items-center gap-3 mb-4' }, [
                                    h('div', { className: 'p-2 bg-blue-100 rounded-lg text-2xl' }, 'üìà'),
                                    h('h3', { className: 'font-semibold text-gray-800' }, 'Best Streak')
                                ]),
                                h('div', { className: 'text-2xl font-bold text-blue-600' }, 
                                    `${Math.max(...activities.map(activity => getActivityStreak(activity.id)))} days`
                                )
                            ]),
                            h('div', { key: 'perfect', className: 'bg-white rounded-xl p-6 shadow-lg border border-gray-100' }, [
                                h('div', { className: 'flex items-center gap-3 mb-4' }, [
                                    h('div', { className: 'p-2 bg-green-100 rounded-lg text-2xl' }, 'üèÜ'),
                                    h('h3', { className: 'font-semibold text-gray-800' }, 'Perfect Days')
                                ]),
                                h('div', { className: 'text-2xl font-bold text-green-600' }, `${getCompletedDays()}/40`)
                            ]),
                            h('div', { key: 'progress', className: 'bg-white rounded-xl p-6 shadow-lg border border-gray-100' }, [
                                h('div', { className: 'flex items-center gap-3 mb-4' }, [
                                    h('div', { className: 'p-2 bg-purple-100 rounded-lg text-2xl' }, 'üéØ'),
                                    h('h3', { className: 'font-semibold text-gray-800' }, 'Overall Progress')
                                ]),
                                h('div', { className: 'text-2xl font-bold text-purple-600' }, `${getTotalProgress()}%`)
                            ])
                        ]),

                        // Progress Overview
                        h('div', { key: 'overview', className: 'bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden' }, [
                            h('div', { key: 'header', className: 'bg-gradient-to-r from-gray-50 to-gray-100 px-6 py-4 border-b' },
                                h('h2', { className: 'text-xl font-bold text-gray-800' }, '40-Day Overview')
                            ),
                            h('div', { key: 'content', className: 'p-6' }, [
                                h('div', { key: 'grid', className: 'grid grid-cols-10 gap-2' },
                                    Array.from({ length: 40 }, (_, i) => i + 1).map(day => {
                                        const progress = getDayProgress(day);
                                        return h('div', {
                                            key: day,
                                            className: `w-full h-8 rounded-md border-2 cursor-pointer transition-all duration-200 flex items-center justify-center text-xs font-semibold ${
                                                day === currentDay
                                                    ? 'border-indigo-500 bg-indigo-100'
                                                    : progress === 100
                                                    ? 'border-green-400 bg-green-400 text-white'
                                                    : progress > 0
                                                    ? 'border-yellow-400 bg-yellow-400 text-white'
                                                    : 'border-gray-200 bg-gray-100 text-gray-500'
                                            }`,
                                            onClick: () => isAuthenticated ? setCurrentDay(day) : showAuthPrompt('login'),
                                            title: `Day ${day}: ${progress}% complete`
                                        }, day.toString());
                                    })
                                ),
                                h('div', { key: 'legend', className: 'flex items-center justify-center gap-6 mt-4 text-sm' }, [
                                    h('div', { key: 'not-started', className: 'flex items-center gap-2' }, [
                                        h('div', { className: 'w-4 h-4 bg-gray-100 border border-gray-200 rounded' }),
                                        h('span', {}, 'Not started')
                                    ]),
                                    h('div', { key: 'progress', className: 'flex items-center gap-2' }, [
                                        h('div', { className: 'w-4 h-4 bg-yellow-400 rounded' }),
                                        h('span', {}, 'In progress')
                                    ]),
                                    h('div', { key: 'complete', className: 'flex items-center gap-2' }, [
                                        h('div', { className: 'w-4 h-4 bg-green-400 rounded' }),
                                        h('span', {}, 'Complete')
                                    ])
                                ])
                            ])
                        ])
                    ])
                ]);
            }

            ReactDOM.render(React.createElement(HabitTracker), document.getElementById('root'));
        }

        initializeApp();
    </script>
</body>
</html>
