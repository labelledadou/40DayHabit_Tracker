<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>40-Day Habit Tracker</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-30px,0); }
            70% { transform: translate3d(0,-15px,0); }
            90% { transform: translate3d(0,-4px,0); }
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body>
    <div id="loading" style="display: flex; justify-content: center; align-items: center; height: 100vh; font-size: 24px;">
        Loading your habit tracker... ‚è≥
    </div>
    <div id="root"></div>

    <script>
        // Wait for React to load
        function initializeApp() {
            if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
                setTimeout(initializeApp, 100);
                return;
            }

            // Hide loading, show app
            document.getElementById('loading').style.display = 'none';
            document.getElementById('root').style.display = 'block';

            const { useState, useEffect } = React;
            const { createElement: h } = React;

            function HabitTracker() {
                const [currentDay, setCurrentDay] = useState(1);
                const [activities, setActivities] = useState([
                    { id: 1, name: 'Morning Exercise', color: 'from-blue-400 to-blue-600', icon: 'üèÉ‚Äç‚ôÇÔ∏è' },
                    { id: 2, name: 'Read 30 Minutes', color: 'from-green-400 to-green-600', icon: 'üìö' },
                    { id: 3, name: 'Meditate', color: 'from-purple-400 to-purple-600', icon: 'üßò‚Äç‚ôÄÔ∏è' },
                    { id: 4, name: 'Drink 8 Glasses Water', color: 'from-cyan-400 to-cyan-600', icon: 'üíß' },
                    { id: 5, name: 'Journal', color: 'from-orange-400 to-orange-600', icon: '‚úçÔ∏è' }
                ]);
                
                const [completedActivities, setCompletedActivities] = useState({});
                const [showCelebration, setShowCelebration] = useState(false);
                const [isEditingActivities, setIsEditingActivities] = useState(false);
                const [newActivity, setNewActivity] = useState({ name: '', icon: '‚ú®' });
                const [editingActivity, setEditingActivity] = useState(null);
                
                // Supabase state
                const [supabaseUrl, setSupabaseUrl] = useState('');
                const [supabaseKey, setSupabaseKey] = useState('');
                const [userId, setUserId] = useState('');
                const [isConnected, setIsConnected] = useState(false);
                const [showSupabaseSetup, setShowSupabaseSetup] = useState(false);

                // Initialize completed activities structure
                useEffect(() => {
                    const initialState = {};
                    for (let day = 1; day <= 40; day++) {
                        initialState[day] = {};
                        activities.forEach(activity => {
                            initialState[day][activity.id] = false;
                        });
                    }
                    setCompletedActivities(initialState);
                }, []);

                const toggleActivity = (dayNum, activityId) => {
                    setCompletedActivities(prev => ({
                        ...prev,
                        [dayNum]: {
                            ...prev[dayNum],
                            [activityId]: !prev[dayNum]?.[activityId]
                        }
                    }));

                    // Show celebration if this completes all activities for the day
                    const dayActivities = { ...completedActivities[dayNum] };
                    dayActivities[activityId] = !dayActivities[activityId];
                    const allCompleted = activities.every(activity => dayActivities[activity.id]);
                    
                    if (allCompleted && !completedActivities[dayNum]?.[activityId]) {
                        setShowCelebration(true);
                        setTimeout(() => setShowCelebration(false), 2000);
                    }
                };

                const getActivityStreak = (activityId) => {
                    let streak = 0;
                    for (let day = currentDay; day >= 1; day--) {
                        if (completedActivities[day]?.[activityId]) {
                            streak++;
                        } else {
                            break;
                        }
                    }
                    return streak;
                };

                const getTotalProgress = () => {
                    let completed = 0;
                    let total = 0;
                    for (let day = 1; day <= 40; day++) {
                        activities.forEach(activity => {
                            total++;
                            if (completedActivities[day]?.[activity.id]) {
                                completed++;
                            }
                        });
                    }
                    return Math.round((completed / total) * 100);
                };

                const getDayProgress = (dayNum) => {
                    if (!completedActivities[dayNum]) return 0;
                    const completed = activities.filter(activity => completedActivities[dayNum][activity.id]).length;
                    return Math.round((completed / activities.length) * 100);
                };

                const getCompletedDays = () => {
                    let completedDays = 0;
                    for (let day = 1; day <= 40; day++) {
                        if (getDayProgress(day) === 100) {
                            completedDays++;
                        }
                    }
                    return completedDays;
                };

                const availableColors = [
                    'from-blue-400 to-blue-600',
                    'from-green-400 to-green-600',
                    'from-purple-400 to-purple-600',
                    'from-cyan-400 to-cyan-600',
                    'from-orange-400 to-orange-600',
                    'from-pink-400 to-pink-600',
                    'from-red-400 to-red-600',
                    'from-indigo-400 to-indigo-600',
                    'from-yellow-400 to-yellow-600',
                    'from-teal-400 to-teal-600'
                ];

                const availableIcons = ['‚ú®', 'üèÉ‚Äç‚ôÇÔ∏è', 'üìö', 'üßò‚Äç‚ôÄÔ∏è', 'üíß', '‚úçÔ∏è', 'üçé', 'üí™', 'üéØ', 'üå±', 'üéµ', 'üî•', '‚≠ê', 'üöÄ', 'üíù'];

                const addActivity = () => {
                    if (!newActivity.name.trim()) return;
                    
                    const maxId = Math.max(...activities.map(a => a.id), 0);
                    const newId = maxId + 1;
                    const randomColor = availableColors[Math.floor(Math.random() * availableColors.length)];
                    
                    const activity = {
                        id: newId,
                        name: newActivity.name,
                        color: randomColor,
                        icon: newActivity.icon
                    };

                    setActivities([...activities, activity]);
                    setNewActivity({ name: '', icon: '‚ú®' });

                    // Initialize this activity in all days
                    setCompletedActivities(prev => {
                        const updated = { ...prev };
                        for (let day = 1; day <= 40; day++) {
                            if (!updated[day]) updated[day] = {};
                            updated[day][newId] = false;
                        }
                        return updated;
                    });
                };

                const deleteActivity = (activityId) => {
                    setActivities(activities.filter(a => a.id !== activityId));
                    
                    // Remove from completed activities
                    setCompletedActivities(prev => {
                        const updated = { ...prev };
                        for (let day = 1; day <= 40; day++) {
                            if (updated[day]) {
                                delete updated[day][activityId];
                            }
                        }
                        return updated;
                    });
                };

                const updateActivity = (activityId, updates) => {
                    setActivities(activities.map(a => 
                        a.id === activityId ? { ...a, ...updates } : a
                    ));
                    setEditingActivity(null);
                };

                const moveActivity = (activityId, direction) => {
                    const currentIndex = activities.findIndex(a => a.id === activityId);
                    const newIndex = direction === 'up' ? currentIndex - 1 : currentIndex + 1;
                    
                    if (newIndex < 0 || newIndex >= activities.length) return;
                    
                    const newActivities = [...activities];
                    [newActivities[currentIndex], newActivities[newIndex]] = [newActivities[newIndex], newActivities[currentIndex]];
                    setActivities(newActivities);
                };

                const exportData = () => {
                    const exportObject = {
                        version: '1.0',
                        exportDate: new Date().toISOString(),
                        currentDay,
                        activities,
                        completedActivities
                    };
                    
                    const dataStr = JSON.stringify(exportObject, null, 2);
                    const dataBlob = new Blob([dataStr], { type: 'application/json' });
                    const url = URL.createObjectURL(dataBlob);
                    
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `40-day-tracker-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                };

                const importData = (event) => {
                    const file = event.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedData = JSON.parse(e.target.result);
                            
                            if (importedData.activities && importedData.completedActivities) {
                                setActivities(importedData.activities);
                                setCompletedActivities(importedData.completedActivities);
                                if (importedData.currentDay) {
                                    setCurrentDay(importedData.currentDay);
                                }
                                alert('Data imported successfully!');
                            } else {
                                alert('Invalid file format. Please select a valid tracker export file.');
                            }
                        } catch (error) {
                            alert('Error reading file. Please make sure it\'s a valid JSON export file.');
                        }
                    };
                    reader.readAsText(file);
                    
                    event.target.value = '';
                };

                const connectToSupabase = () => {
                    if (supabaseUrl && supabaseKey && userId) {
                        setIsConnected(true);
                        setShowSupabaseSetup(false);
                        alert('Successfully connected to Supabase! Your data will now sync to the cloud.');
                    }
                };

                return h('div', { className: 'min-h-screen bg-gradient-to-br from-indigo-50 via-white to-purple-50' }, [
                    // Celebration Animation
                    showCelebration && h('div', { 
                        key: 'celebration',
                        className: 'fixed inset-0 flex items-center justify-center z-50 pointer-events-none' 
                    }, 
                        h('div', { className: 'animate-bounce text-6xl' }, 'üéâ')
                    ),

                    // Header
                    h('div', { 
                        key: 'header',
                        className: 'bg-white/80 backdrop-blur-sm border-b border-gray-200/50 sticky top-0 z-40' 
                    },
                        h('div', { className: 'max-w-6xl mx-auto px-6 py-6' },
                            h('div', { className: 'flex items-center justify-between flex-wrap gap-4' }, [
                                h('div', { key: 'title', className: 'flex items-center gap-3' }, [
                                    h('div', { 
                                        key: 'icon',
                                        className: 'p-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl text-white' 
                                    }, 'üéØ'),
                                    h('div', { key: 'text' }, [
                                        h('h1', { className: 'text-2xl font-bold text-gray-800' }, '40-Day Challenge'),
                                        h('p', { className: 'text-gray-600' }, 'Transform your habits, day by day')
                                    ])
                                ]),
                                h('div', { key: 'controls', className: 'flex items-center gap-6' }, [
                                    h('div', { key: 'buttons', className: 'flex items-center gap-2' }, [
                                        h('button', {
                                            key: 'setup',
                                            onClick: () => setShowSupabaseSetup(true),
                                            className: `flex items-center gap-2 px-3 py-2 rounded-xl transition-all duration-200 ${
                                                isConnected 
                                                    ? 'bg-green-100 text-green-700' 
                                                    : 'bg-yellow-100 text-yellow-700 hover:bg-yellow-200'
                                            }`,
                                            title: isConnected ? 'Connected to cloud' : 'Setup cloud sync'
                                        }, [
                                            h('span', { key: 'icon' }, isConnected ? '‚òÅÔ∏è' : 'üîí'),
                                            h('span', { key: 'text', className: 'hidden sm:inline' }, isConnected ? 'Cloud' : 'Setup')
                                        ]),
                                        h('button', {
                                            key: 'export',
                                            onClick: exportData,
                                            className: 'flex items-center gap-2 px-3 py-2 bg-blue-100 text-blue-700 hover:bg-blue-200 rounded-xl transition-all duration-200',
                                            title: 'Export backup file'
                                        }, [
                                            h('span', { key: 'icon' }, '‚¨áÔ∏è'),
                                            h('span', { key: 'text', className: 'hidden sm:inline' }, 'Export')
                                        ]),
                                        h('label', {
                                            key: 'import',
                                            className: 'flex items-center gap-2 px-3 py-2 bg-purple-100 text-purple-700 hover:bg-purple-200 rounded-xl transition-all duration-200 cursor-pointer'
                                        }, [
                                            h('span', { key: 'icon' }, '‚¨ÜÔ∏è'),
                                            h('span', { key: 'text', className: 'hidden sm:inline' }, 'Import'),
                                            h('input', {
                                                key: 'input',
                                                type: 'file',
                                                accept: '.json',
                                                onChange: importData,
                                                className: 'hidden'
                                            })
                                        ])
                                    ]),
                                    h('button', {
                                        key: 'edit',
                                        onClick: () => setIsEditingActivities(!isEditingActivities),
                                        className: `flex items-center gap-2 px-4 py-2 rounded-xl transition-all duration-200 ${
                                            isEditingActivities 
                                                ? 'bg-indigo-100 text-indigo-700' 
                                                : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                        }`
                                    }, [
                                        h('span', { key: 'icon' }, '‚öôÔ∏è'),
                                        h('span', { key: 'text', className: 'hidden sm:inline' }, 'Edit Activities')
                                    ]),
                                    h('div', { key: 'stats1', className: 'text-center' }, [
                                        h('div', { className: 'text-2xl font-bold text-indigo-600' }, `${getCompletedDays()}/40`),
                                        h('div', { className: 'text-sm text-gray-600' }, 'Perfect Days')
                                    ]),
                                    h('div', { key: 'stats2', className: 'text-center' }, [
                                        h('div', { className: 'text-2xl font-bold text-purple-600' }, `${getTotalProgress()}%`),
                                        h('div', { className: 'text-sm text-gray-600' }, 'Overall Progress')
                                    ])
                                ])
                            ])
                        )
                    ),

                    // Main Content Container
                    h('div', { key: 'main', className: 'max-w-6xl mx-auto px-6 py-8' }, [
                        // Supabase Setup Modal
                        showSupabaseSetup && h('div', {
                            key: 'modal',
                            className: 'fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4'
                        },
                            h('div', { className: 'bg-white rounded-2xl shadow-2xl max-w-md w-full p-6' }, [
                                h('div', { key: 'header', className: 'flex items-center justify-between mb-4' }, [
                                    h('h3', { className: 'text-xl font-bold text-gray-800' }, 'Cloud Sync Setup'),
                                    h('button', {
                                        onClick: () => setShowSupabaseSetup(false),
                                        className: 'p-2 hover:bg-gray-100 rounded-lg'
                                    }, '‚úï')
                                ]),
                                !isConnected ? h('div', { key: 'form', className: 'space-y-4' }, [
                                    h('div', { key: 'url' }, [
                                        h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Supabase Project URL'),
                                        h('input', {
                                            type: 'text',
                                            value: supabaseUrl,
                                            onChange: (e) => setSupabaseUrl(e.target.value),
                                            placeholder: 'https://your-project.supabase.co',
                                            className: 'w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none'
                                        })
                                    ]),
                                    h('div', { key: 'key' }, [
                                        h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Supabase API Key'),
                                        h('input', {
                                            type: 'password',
                                            value: supabaseKey,
                                            onChange: (e) => setSupabaseKey(e.target.value),
                                            placeholder: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...',
                                            className: 'w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none'
                                        })
                                    ]),
                                    h('div', { key: 'user' }, [
                                        h('label', { className: 'block text-sm font-medium text-gray-700 mb-2' }, 'Your User ID'),
                                        h('input', {
                                            type: 'text',
                                            value: userId,
                                            onChange: (e) => setUserId(e.target.value),
                                            placeholder: 'your-name-or-email',
                                            className: 'w-full p-3 border border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none'
                                        })
                                    ]),
                                    h('button', {
                                        key: 'connect',
                                        onClick: connectToSupabase,
                                        disabled: !supabaseUrl || !supabaseKey || !userId,
                                        className: 'w-full px-4 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-lg hover:opacity-90 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200'
                                    }, 'Connect to Cloud')
                                ]) : h('div', { key: 'connected', className: 'text-center space-y-4' }, [
                                    h('div', { className: 'text-green-600' }, [
                                        h('div', { className: 'text-4xl mb-2' }, '‚òÅÔ∏è'),
                                        h('p', { className: 'font-semibold' }, 'Connected to Cloud!'),
                                        h('p', { className: 'text-sm text-gray-600' }, 'Your progress syncs to Supabase')
                                    ]),
                                    h('button', {
                                        onClick: () => {
                                            setIsConnected(false);
                                            setShowSupabaseSetup(false);
                                        },
                                        className: 'w-full px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-all duration-200'
                                    }, 'Disconnect')
                                ])
                            ])
                        ),

                        // Day Selector
                        h('div', { key: 'days', className: 'mb-8' }, [
                            h('div', { key: 'header', className: 'flex items-center gap-4 mb-4' }, [
                                h('span', { className: 'text-indigo-600 text-xl' }, 'üìÖ'),
                                h('h2', { className: 'text-lg font-semibold text-gray-800' }, 'Select Day')
                            ]),
                            h('div', { key: 'buttons', className: 'flex flex-wrap gap-2' },
                                Array.from({ length: 40 }, (_, i) => i + 1).map(day =>
                                    h('button', {
                                        key: day,
                                        onClick: () => setCurrentDay(day),
                                        className: `w-12 h-12 rounded-lg font-semibold transition-all duration-200 ${
                                            currentDay === day
                                                ? 'bg-gradient-to-r from-indigo-500 to-purple-600 text-white shadow-lg scale-110'
                                                : getDayProgress(day) === 100
                                                ? 'bg-gradient-to-r from-green-400 to-green-600 text-white'
                                                : getDayProgress(day) > 0
                                                ? 'bg-gradient-to-r from-yellow-400 to-orange-500 text-white'
                                                : 'bg-white border-2 border-gray-200 text-gray-600 hover:border-indigo-300'
                                        }`
                                    }, day.toString())
                                )
                            )
                        ]),

                        // Current Day Activities
                        h('div', { key: 'activities', className: 'bg-white rounded-2xl shadow-xl border border-gray-100 overflow-hidden mb-8' }, [
                            h('div', { key: 'header', className: 'bg-gradient-to-r from-indigo-500 to-purple-600 px-6 py-4' },
                                h('div', { className: 'flex items-center justify-between text-white' }, [
                                    h('h2', { className: 'text-xl font-bold' }, `Day ${currentDay} Activities`),
                                    h('div', { className: 'flex items-center gap-2' }, [
                                        h('div', { className: 'text-sm opacity-90' }, 'Progress:'),
                                        h('div', { className: 'text-lg font-bold' }, `${getDayProgress(currentDay)}%`)
                                    ])
                                ])
                            ),
                            h('div', { key: 'content', className: 'p-6 space-y-4' },
                                activities.map(activity => {
                                    const isCompleted = completedActivities[currentDay]?.[activity.id];
                                    const streak = getActivityStreak(activity.id);
                                    
                                    return h('div', {
                                        key: activity.id,
                                        className: `p-4 rounded-xl border-2 transition-all duration-300 cursor-pointer ${
                                            isCompleted
                                                ? 'border-green-300 bg-green-50'
                                                : 'border-gray-200 bg-gray-50 hover:border-indigo-300 hover:bg-indigo-50'
                                        }`,
                                        onClick: () => toggleActivity(currentDay, activity.id)
                                    },
                                        h('div', { className: 'flex items-center justify-between' }, [
                                            h('div', { key: 'info', className: 'flex items-center gap-4' }, [
                                                h('div', { className: 'text-2xl' }, activity.icon),
                                                h('div', { key: 'details' }, [
                                                    h('h3', { className: 'font-semibold text-gray-800' }, activity.name),
                                                    streak > 0 && h('div', { className: 'flex items-center gap-1 mt-1' }, [
                                                        h('span', { className: 'text-orange-500' }, 'üî•'),
                                                        h('span', { className: 'text-sm text-orange-600' }, `${streak} day streak`)
                                                    ])
                                                ])
                                            ]),
                                            h('div', {
                                                key: 'status',
                                                className: `p-2 rounded-full transition-all duration-200 ${
                                                    isCompleted ? 'bg-green-500' : 'bg-gray-300'
                                                }`
                                            }, 
                                                h('span', { 
                                                    className: 'text-white text-xl block w-6 h-6 flex items-center justify-center' 
                                                }, isCompleted ? '‚úì' : '‚óã')
                                            )
                                        ])
                                    );
                                })
                            )
                        ])
                    ])
                ]);
            }

            ReactDOM.render(React.createElement(HabitTracker), document.getElementById('root'));
        }

        // Start the initialization
        initializeApp();
    </script>
</body>
</html>
